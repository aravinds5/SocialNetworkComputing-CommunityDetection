/*! w3sink v0.0.0 - 2014-03-07 
 *  License: ISC */

!function(a){"use strict";function b(a,b){for(var c in a)b.hasOwnProperty(c)||(b[c]=a[c])}function c(a,b){var c=/(\d+)(\w+)?/,d=c.exec(b);return d[1]}function d(a){this.id=a,this.timeId=0,this.sinks=[]}function e(){}function f(a,b,c){this.id=c,this.type=b,this.graph=a,this.attributes={}}function g(a,b){f.call(this,a,"Node",b),this.edges={},this._x=0,this._y=0,this.pixelX=a.randomPixelX(),this.pixelY=a.randomPixelY(),this.index=a.indexedNodes.length,a.indexedNodes.push(this)}function h(a,b,c,d,e){f.call(this,a,"Edge",b),this.source=c,this.target=d,this.directed=e,this.points=[{x:c.pixelX,y:c.pixelY},{x:d.pixelX,y:d.pixelY}],this.index=a.indexedEdges.length,a.indexedEdges.push(this)}function i(b,c){if(d.call(this,b),"undefined"==typeof c&&(c="default"),!n.hasOwnProperty(c))throw new Error('context "'+c+'" is not registered');this.context=new n[c](b),this.nodes={},this.edges={},this.indexedNodes=[],this.indexedEdges=[],this.default_node_style="fill-color:#89a9e3;size:10px;stroke-color:#333333;stroke-width:5px;",this.default_node_size=15,this.default_edge_style="stroke-color:#333333;stroke-width:2px;",this.viewbox=new k(this),this.dispatch=new e,this._width=a.jQuery(this.context.getContainer()).width(),this._height=a.jQuery(this.context.getContainer()).height()}function j(a){this.container=document.querySelector(a)}function k(a){this.graph=a,this.minx=1/0,this.miny=1/0,this.maxx=-1/0,this.maxy=-1/0,this.padding={top:15,right:15,bottom:15,left:15}}function l(a){d.call(this,a),this.type=a}function m(a,b){n[a]=b}d.prototype={addSink:function(a){this.sinks.push(a)},removeSink:function(){},newTimeId:function(){return this.timeId++},sendNodeAdded:function(a){for(var b=this.newTimeId(),c=0;c<this.sinks.length;c++)this.sinks[c].nodeAdded(this.id,b,a)},sendNodeRemoved:function(a){for(var b=this.newTimeId(),c=0;c<this.sinks.length;c++)this.sinks[c].nodeRemoved(this.id,b,a)},sendNodeAttributeAdded:function(a,b,c){for(var d=this.newTimeId(),e=0;e<this.sinks.length;e++)this.sinks[e].nodeAttributeAdded(this.id,d,a,b,c)},sendNodeAttributeChanged:function(a,b,c,d){var e=this.newTimeId();void 0===d&&(d=c);for(var f=0;f<this.sinks.length;f++)this.sinks[f].nodeAttributeChanged(this.id,e,a,b,c,d)},sendNodeAttributeRemoved:function(a,b){for(var c=this.newTimeId(),d=0;d<this.sinks.length;d++)this.sinks[d].nodeAttributeRemoved(this.id,c,a,b)},sendEdgeAdded:function(a,b,c,d){var e=this.newTimeId();void 0===d&&(d=!1);for(var f=0;f<this.sinks.length;f++)this.sinks[f].edgeAdded(this.id,e,a,b,c,d)},sendEdgeRemoved:function(a){for(var b=this.newTimeId(),c=0;c<this.sinks.length;c++)this.sinks[c].edgeRemoved(this.id,b,a)},sendEdgeAttributeAdded:function(a,b,c){for(var d=this.newTimeId(),e=0;e<this.sinks.length;e++)this.sinks[e].edgeAttributeAdded(this.id,d,a,b,c)},sendEdgeAttributeChanged:function(a,b,c,d){var e=this.newTimeId();void 0===d&&(d=c);for(var f=0;f<this.sinks.length;f++)this.sinks[f].edgeAttributeChanged(this.id,e,a,b,c,d)},sendEdgeAttributeRemoved:function(a,b){for(var c=this.newTimeId(),d=0;d<this.sinks.length;d++)this.sinks[d].edgeAttributeRemoved(this.id,c,a,b)},sendGraphAttributeAdded:function(a){for(var b=this.newTimeId(),c=0;c<this.sinks.length;c++)this.sinks[c].graphAttributeAdded(this.id,b,a)},sendGraphAttributeChanged:function(a,b,c){var d=this.newTimeId();void 0===c&&(c=b);for(var e=0;e<this.sinks.length;e++)this.sinks[e].graphAttributeChanged(this.id,d,a,b,c)},sendGraphAttributeRemoved:function(a){for(var b=this.newTimeId(),c=0;c<this.sinks.length;c++)this.sinks[c].graphAttributeRemoved(this.id,b,a)},sendGraphCleared:function(){for(var a=this.newTimeId(),b=0;b<this.sinks.length;b++)this.sinks[b].graphCleared(this.id,a)},sendStepBegins:function(a){for(var b=this.newTimeId(),c=0;c<this.sinks.length;c++)this.sinks[c].stepBegins(this.id,b,a)}},e.prototype={nodeAdded:function(){},nodeRemoved:function(){},nodeAttributeAdded:function(){},nodeAttributeChanged:function(){},nodeAttributeRemoved:function(){},edgeAdded:function(){},edgeRemoved:function(){},edgeAttributeAdded:function(){},edgeAttributeChanged:function(){},edgeAttributeRemoved:function(){},graphAttributeAdded:function(){},graphAttributeChanged:function(){},graphAttributeRemoved:function(){},graphCleared:function(){},stepBegins:function(){}},f.prototype={getAttribute:function(a){return this.attributes[a]},setAttribute:function(a,b){this.attributes[a]=b},hasAttribute:function(a){return this.attributes.hasOwnProperty(a)},removeAttribute:function(a){delete this.attributes[a]},setFill:function(){},setStroke:function(){},setStrokeWidth:function(){},setSize:function(){},setLabel:function(){},setStyle:function(b){var d,e,f,g=b.split(/\s*;\s*/);for(e=0;e<g.length;e++)if(""!==g[e])switch(f=g[e].split(/\s*:\s*/),f[0]){case"fill-color":d=f[1].split(/\s*,\s*/),this.setFill(d[0]);break;case"stroke-color":d=f[1].split(/\s*,\s*/),this.setStroke(d[0]);break;case"stroke-width":this.setStrokeWidth(c(this,f[1]));break;case"z-index":this.setZIndex(f[1]);break;case"size":this.setSize(c(this,f[1]));break;case"fill-image":case"fill-mode":case"stroke-mode":case"padding":case"shadow-mode":case"shadow-color":case"shadow-width":case"shadow-offset":case"text-mode":case"text-background-mode":case"text-visibility-mode":case"text-visibility":case"text-color":case"text-background-color":case"text-style":case"text-alignment":case"text-padding":case"text-offset":case"text-font":case"text-size":case"icon":case"icon-mode":case"visibility":case"visibility-mode":case"size-mode":case"shape":case"arrow-shape":case"arrow-image":case"arrow-size":case"shape-points":a.console.log('[GraphStream CSS] unsupported property "'+f[0]+'" for '+this.type);break;default:a.console.log('[GraphStream CSS] unknown property "'+f[0]+'" for '+this.type)}},updateShapePosition:function(){}},g.prototype={registerEdge:function(a){this.edges[a.id]=a},unregisterEdge:function(a){delete this.edges[a.id]},x:function(a){if("undefined"==typeof a)return this._x;this._x=a;for(var b in this.edges)this.edges[b].nodePositionChanged(this)},y:function(a){if("undefined"==typeof a)return this._y;this._y=a;for(var b in this.edges)this.edges[b].nodePositionChanged(this)},setXY:function(a,b){this._x=a,this._y=b,this.graph.viewbox.check(a,b),this.graph.viewbox.update(this)},setPixelXY:function(a,b){this.pixelX=a,this.pixelY=b,this.updateShapePosition();for(var c in this.edges)this.edges[c].nodePositionChanged();return this}},h.prototype={nodePositionChanged:function(){this.points[0].x=this.source.pixelX,this.points[0].y=this.source.pixelY,this.points[this.points.length-1].x=this.target.pixelX,this.points[this.points.length-1].y=this.target.pixelY,this.updateShapePosition()}},b(f.prototype,g.prototype),b(f.prototype,h.prototype),i.prototype={width:function(){return this._width},height:function(){return this._height},an:function(b){if(this.nodes.hasOwnProperty(b))return void a.console.log('[warning] node exists "'+b+'"');var c=this.context.createNode(this,b);this.nodes[b]=c,c.setStyle(this.default_node_style),this.nodesCount++,this.sendNodeAdded(b)},cn:function(a,b,c){var d=this.nodes[a];void 0===c?(d.removeAttribute(b),this.sendNodeAttributeRemoved(a,b)):("xy"===b||"xyz"===b?d.setXY(c[0],c[1]):"size"===b?d.setSize(c):"style"===b?d.setStyle(c):"label"===b&&d.setLabel(c),d.setAttribute(b,c),this.sendNodeAttributeChanged(a,b,c))},setXY:function(a,b,c){var d=this.nodes[a];d.setXY(b,c)},setPixelXY:function(a,b,c){var d=this.nodes[a];d.setPixelXY(b,c)},dn:function(a){var b=[],c=this.nodes[a];for(var d in this.edges)(this.edges[d].source.id===a||this.edges[d].target.id===a)&&b.push(this.edges[e]);for(var e=0;e<b.length;e++)this.de(b[e].id);if(this.sendNodeRemoved(a),this.context.removeNode(this,c),c.index===this.indexedNodes.length-1)this.indexedNodes.pop();else{var f=this.indexedNodes[this.indexedNodes.length-1],g=f.index,h=c.index;f.index=h,this.indexedNodes[h]=f,this.indexedNodes.pop(),this.context.nodeIndexChanged(f,g,h)}delete this.nodes[a]},ae:function(b,c,d,e){if(void 0===this.nodes[c])return void a.console.log('node "'+c+'" not found for edge "'+b+'"');if(void 0===this.nodes[d])return void a.console.log('node "'+d+'" not found for edge "'+b+'"');var f=this.context.createEdge(this,b,this.nodes[c],this.nodes[d],e);this.edges[b]=f,f.setStyle(this.default_edge_style),this.nodes[c].edges[b]=f,this.nodes[d].edges[b]=f,this.edgesCount++,this.sendEdgeAdded(b,c,d,e)},ce:function(a,b,c){var d=this.edges[a];"undefined"==typeof c?(d.removeAttribute(d),this.sendEdgeAttributeRemoved(a,b)):("style"===b?d.setStyle(c):"size"===b&&d.setSize(c),d.setAttribute(b,c),this.sendEdgeAttributeChanged(a,b,c))},de:function(a){var b=this.edges[a];if(this.sendEdgeRemoved(a),this.context.removeEdge(this,b),delete b.source.edges[a],delete b.target.edges[a],b.index===this.indexedEdges.length-1)this.indexedEdges.pop();else{var c=this.indexedEdges[this.indexedEdges.length-1],d=c.index,e=b.index;c.index=e,this.indexedEdges[e]=c,this.indexedEdges.pop(),this.context.edgeIndexChanged(c,d,e)}delete this.edges[a]},cg:function(){},cl:function(){this.context.clear(),this.sendGraphCleared()},st:function(a){this.sendStepBegins(a)},randomPixelX:function(a){return void 0===a&&(a=Math.random()),~~(a*this.width())},randomPixelY:function(a){return void 0===a&&(a=Math.random()),~~(a*this.height())},nodeAdded:function(a,b,c){this.an(c)},nodeRemoved:function(a,b,c){this.dn(c)},nodeAttributeAdded:function(a,b,c,d,e){this.cn(c,d,e)},nodeAttributeChanged:function(a,b,c,d,e,f){this.cn(c,d,f)},nodeAttributeRemoved:function(a,b,c,d){this.cn(c,d,null)},edgeAdded:function(a,b,c,d,e,f){this.ae(c,d,e,f)},edgeRemoved:function(a,b,c){this.de(c)},edgeAttributeAdded:function(a,b,c,d,e){this.ce(c,d,e)},edgeAttributeChanged:function(a,b,c,d,e,f){this.ce(c,d,f)},edgeAttributeRemoved:function(a,b,c,d){this.ce(c,d,null)},graphAttributeAdded:function(a,b,c,d){this.cg(c,d)},graphAttributeChanged:function(a,b,c,d,e){this.cg(c,e)},graphAttributeRemoved:function(a,b,c){this.cg(c,null)},graphCleared:function(){this.cl()},stepBegins:function(a,b,c){this.st(c)}},b(d.prototype,i.prototype),j.prototype={getContainer:function(){return this.container},createNode:function(a,b){return new g(a,b)},removeNode:function(){},createEdge:function(a,b,c,d,e){return new h(a,b,c,d,e)},removeEdge:function(){},clear:function(){},zoom:function(){},nodeIndexChanged:function(){},edgeIndexChanged:function(){}},k.prototype={reset:function(){this.minx=1/0,this.miny=1/0,this.maxx=-1/0,this.maxy=-1/0},check:function(a,b){var c=!1;a<this.minx&&(c=!0,this.minx=a),b<this.miny&&(c=!0,this.miny=b),a>this.maxx&&(c=!0,this.maxx=a),b>this.maxy&&(c=!0,this.maxy=b),c&&(this.minx===this.maxx&&(this.minx-=.1,this.maxx+=.1),this.miny===this.maxy&&(this.miny-=.1,this.maxy+=.1),this.update())},compute:function(){var a,b,c,d;a=b=1/0,c=d=-1/0;for(var e in this.graph.nodes){var f=this.graph.nodes[e];a=Math.min(a,f._x),b=Math.min(b,f._y),c=Math.max(c,f._x),d=Math.max(d,f._y)}this.minx=a,this.miny=b,this.maxx=c,this.maxy=d,this.update()},update:function(a){if(void 0===a)for(var b in this.graph.nodes)this.update(this.graph.nodes[b]);else{var c=(a._x-this.minx)/(this.maxx-this.minx),d=(a._y-this.miny)/(this.maxy-this.miny);c=this.padding.left+(this.graph.width()-this.padding.left-this.padding.right)*c,d=this.padding.bottom+(this.graph.height()-this.padding.bottom-this.padding.top)*d,a.setPixelXY(c,d)}}};l.prototype={begin:function(){},nextEvents:function(){},nextStep:function(){},end:function(){}},b(d.prototype,l.prototype);var n={"default":j},o={extend:b,Node:g,Edge:h,Graph:i,Context:j,Source:d,Sink:e,FileSource:l,registerContext:m};a.GS=o}(this),function(a){"use strict";function b(){a.GS.FileSource.call(this,"json"),this.data=!1,this.lastEvent=!1}b.prototype={begin:function(b){a.jQuery.ajax({url:b,type:"GET",dataType:"json",async:!1,context:this,success:function(a){this.setData(a)},error:function(b,c,d){a.console.log(c),a.console.log(d)}})},setData:function(b){this.data=b,this.data.events.reverse(),a.console.log(this.data)},nextEvents:function(){var b,c,d,e;if(!this.data)return void a.console.log("no data");if(0===this.data.events.length)return!1;b=this.data.events.pop(),b.reverse();var f=b.pop();switch(f){case"an":this.sendNodeAdded(b.pop());break;case"cn":for(c=b.pop();b.length>0;)switch(e="",d=b.pop(),("+"===d[0]||"-"===d[0]||""===d[0])&&(e=d[0],d.splice(0,1)),e){case"":2===b.length&&b.push(b[1]),this.sendNodeAttributeChanged(c,b[0],b[1],b[2]);break;case"+":this.sendNodeAttributeAdded(c,b[0],b[1]);break;case"-":this.sendNodeAttributeRemoved(c,b[0])}break;case"dn":this.sendNodeRemoved(b.pop());break;case"ae":this.sendEdgeAdded(b.pop(),b.pop(),b.pop(),b.length>0?b.pop():!1);break;case"ce":for(c=b.pop();b.length>0;)switch(e="",d=b.pop(),("+"===d[0]||"-"===d[0]||""===d[0])&&(e=d[0],d.splice(0,1)),e){case"":2===b.length&&b.push(b[1]),this.sendEdgeAttributeChanged(c,b[0],b[1],b[2]);break;case"+":this.sendEdgeAttributeAdded(c,b[0],b[1]);break;case"-":this.sendEdgeAttributeRemoved(c,b[0])}break;case"de":this.sendEdgeRemoved(b.pop());break;case"cg":for(;b.length>0;)switch(e="",d=b.pop(),("+"===d[0]||"-"===d[0]||""===d[0])&&(e=d[0],d.splice(0,1)),e){case"":2===b.length&&b.push(b[1]),this.sendGraphAttributeChanged(b[0],b[1],b[2]);break;case"+":this.sendGraphAttributeAdded(b[0],b[1]);break;case"-":this.sendGraphAttributeRemoved(b[0])}break;case"st":this.sendStepBegins(b.pop());break;case"cl":this.sendGraphCleared();break;default:a.console.log('unknown event "'+f+'"')}return this.lastEvent=f,this.data.events.length>0},nextStep:function(){do this.nextEvents();while("st"!==this.lastEvent&&this.data.events.length>0);return this.data.events.length>0},end:function(){this.data=!1,this.lastEvent=!1}},a.GS.extend(a.GS.FileSource.prototype,b.prototype),a.GS.JSONSource=b}(this),function(a){"use strict";function b(b,c){a.GS.Node.call(this,b,c),this.shape={g:document.createElementNS(e.ns,"g"),node:document.createElementNS(e.ns,"circle"),title:document.createElementNS(e.ns,"title"),label:document.createElementNS(e.ns,"text"),labelText:document.createTextNode(""),labelStroke:document.createElementNS(e.ns,"text"),labelStrokeText:document.createTextNode("")},this.shape.g.setAttribute("transform","translate("+this.pixelX+","+this.pixelY+")"),this.shape.node.setAttribute("class","node"),this.shape.node.setAttribute("r",b.default_node_size),this.shape.node.setAttribute("cx",0),this.shape.node.setAttribute("cy",0),this.shape.node.setAttribute("fill","black"),this.shape.node.setAttribute("stroke","white"),this.shape.node.setAttribute("stroke-width","2px"),this.shape.title.textContent=c,this.shape.label.setAttribute("font-size","12px"),this.shape.label.setAttribute("fill","#ff7200"),this.shape.labelStroke.setAttribute("font-size","12px"),this.shape.labelStroke.setAttribute("fill","#ff7200"),this.shape.labelStroke.setAttribute("stroke","#222222"),this.shape.labelStroke.setAttribute("stroke-width",5),this.shape.label.appendChild(this.shape.labelText),this.shape.labelStroke.appendChild(this.shape.labelStrokeText),this.shape.g.appendChild(this.shape.node),this.shape.g.appendChild(this.shape.title),this.shape.g.appendChild(this.shape.labelStroke),this.shape.g.appendChild(this.shape.label),b.context.gnodes.appendChild(this.shape.g)}function c(b,c,d,f,g){a.GS.Edge.call(this,b,c,d,f,g),this.shape=document.createElementNS(e.ns,"line"),this.shape.setAttribute("class","edge"),this.shape.setAttribute("x1",d.pixelX),this.shape.setAttribute("y1",d.pixelY),this.shape.setAttribute("x2",f.pixelX),this.shape.setAttribute("y2",f.pixelY),this.shape.setAttribute("stroke","black"),this.shape.setAttribute("stroke-width","1px"),b.context.gedges.appendChild(this.shape)}function d(b){a.GS.Context.call(this,b),this.svg=document.createElementNS(e.ns,"svg:svg"),this.svg.setAttribute("width","100%"),this.svg.setAttribute("height","100%"),this.svg.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink",e.xlinkns),this.container.appendChild(this.svg),this.root=document.createElementNS(e.ns,"g"),this.gedges=document.createElementNS(e.ns,"g"),this.gnodes=document.createElementNS(e.ns,"g"),this.root.appendChild(this.gedges),this.root.appendChild(this.gnodes),this.svg.appendChild(this.root)}var e={ns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink"};b.prototype={setFill:function(a){this.shape.node.setAttribute("fill",a)},setStroke:function(a){this.shape.node.setAttribute("stroke",a)},setStrokeWidth:function(a){this.shape.node.setAttribute("stroke-width",a)},setSize:function(a){this.shape.node.setAttribute("r",a)},setLabel:function(a){void 0===a&&(a=this.id),this.shape.labelText.textContent=a,this.shape.labelStrokeText.textContent=a},updateShapePosition:function(){this.shape.g.setAttribute("transform","translate("+this.pixelX+","+this.pixelY+")"),this.pixelX<this.graph.width()/2?(this.shape.label.setAttribute("text-anchor","start"),this.shape.labelStroke.setAttribute("text-anchor","start")):(this.shape.label.setAttribute("text-anchor","end"),this.shape.labelStroke.setAttribute("text-anchor","end"))}},c.prototype={setStroke:function(a){this.shape.setAttribute("stroke",a)},setStrokeWidth:function(a){this.shape.setAttribute("stroke-width",a)},setSize:function(a){this.setStrokeWidth(a)},updateShapePosition:function(){this.shape.setAttribute("x1",this.points[0].x),this.shape.setAttribute("y1",this.points[0].y),this.shape.setAttribute("x2",this.points[this.points.length-1].x),this.shape.setAttribute("y2",this.points[this.points.length-1].y)}},a.GS.extend(a.GS.Node.prototype,b.prototype),a.GS.extend(a.GS.Edge.prototype,c.prototype),d.prototype={createNode:function(a,c){var d=new b(a,c);return d},removeNode:function(a,b){this.gnodes.removeChild(b.shape.g)},createEdge:function(a,b,d,e,f){var g=new c(a,b,d,e,f);return g},removeEdge:function(a,b){this.gedges.removeChild(b.shape)},clear:function(){},zoom:function(a){this.svg.setAttribute("transform","scale("+a+")")}},a.GS.extend(a.GS.Context.prototype,d.prototype),a.GS.registerContext("svg",d)}(this),function(a){"use strict";function b(b,c){a.GS.Node.call(this,b,c),this.shape=new a.Kinetic.Circle({x:b.randomPixelX(),y:b.randomPixelY(),radius:15,fill:"black",stroke:"white",strokeWidth:2})}function c(b,c,d,e,f){a.GS.Edge.call(this,b,c,d,e,f),this.shape=new Kinetic.Line({points:this.points,stroke:"black",strokeWidth:2,lineJoin:"round",lineCap:"round"})}function d(a,b,c){var e,f;for(d.prototype.layers.push(this),void 0===b&&(b=4),void 0===c&&(c=b),this.stage=a,this.drag=new Kinetic.Layer("drag"),this.dragEdges=new Kinetic.Layer("dragEdges"),this.nodes=[],this.edges=[],e=0;c>e;e++)f=new Kinetic.Layer("edges#"+e),f.changed=!0,this.edges.push(f),this.stage.add(f);for(this.stage.add(this.dragEdges),e=0;b>e;e++)f=new Kinetic.Layer("nodes#"+e),f.changed=!0,this.nodes.push(f),this.stage.add(f);this.stage.add(this.drag)}function e(b){a.GS.Context.call(this,b),this.stage=new Kinetic.Stage({container:this.container,width:a.$(this.container).width(),height:a.$(this.container).height()}),this.layers=new d(this.stage)}b.prototype={updateShapePosition:function(){this.shape.setX(this.pixelX),this.shape.setY(this.pixelY),this.graph.context.layers.drawLayerOf(this)},setFill:function(a){this.shape.setFill(a)},setStroke:function(a){this.shape.setStroke(a)},setStrokeWidth:function(a){this.shape.setStrokeWidth(a)},setSize:function(a){this.shape.setRadius(a)}},a.GS.extend(a.GS.Node.prototype,b.prototype),c.prototype={updateShapePosition:function(){this.shape.setPoints(this.points),this.graph.context.layers.drawLayerOf(this)},setFill:function(a){this.shape.setFill(a)},setStroke:function(a){this.shape.setStroke(a)},setStrokeWidth:function(a){this.shape.setStrokeWidth(a)}},a.GS.extend(a.GS.Edge.prototype,c.prototype),d.prototype.layers=[],d.prototype.addNode=function(a){var b=~~(Math.random()*this.nodes.length);this.nodes[b].add(a.shape),this.nodes[b].changed=!0},d.prototype.addEdge=function(a){var b=~~(Math.random()*this.edges.length);this.edges[b].add(a.shape),this.edges[b].changed=!0},d.prototype.removeNode=function(a){var b=a.shape.getLayer();b.remove(a.shape),b.changed=!0},d.prototype.removeEdge=function(a){var b=a.shape.getLayer();b.remove(a.shape),b.changed=!0},d.prototype.drawLayerOf=function(a){a.shape.getLayer().changed=!0},d.prototype.drawAll=function(){var a;for(a=0;a<this.edges.length;a++)this.edges[a].changed&&(this.edges[a].draw(),this.edges[a].changed=!1);for(a=0;a<this.nodes.length;a++)this.nodes[a].changed&&(this.nodes[a].draw(),this.nodes[a].changed=!1)},d.prototype.dragStart=function(a){var b,c,d;for(this.__beforeDragLayer=a.shape.getLayer(),a.shape.moveTo(this.drag),a.shape.draggable(!0),b=0;b<this.nodes.length;b++)this.nodes[b].listen(!1);for(c in a.edges)d=a.edges[c].shape.getLayer(),a.edges[c].shape.moveTo(this.dragEdges),d.draw();this.__beforeDragLayer.draw(),this.drag.draw(),this.dragEdges.draw()},d.prototype.dragEnd=function(a){var b,c,d;for(a.shape.moveTo(this.__beforeDragLayer),a.shape.draggable(!1),b=0;b<this.nodes.length;b++)this.nodes[b].listen(!0);for(c in a.edges)d=~~(Math.random()*this.edges.length),a.edges[c].shape.moveTo(this.edges[d]),this.edges[d].draw();this.__beforeDragLayer.draw(),this.drag.draw(),this.dragEdges.draw()},e.prototype={createNode:function(a,c){var d=new b(a,c);return this.layers.addNode(d),d},removeNode:function(a,b){this.layers.removeNode(b)},createEdge:function(a,b,d,e,f){var g=new c(a,b,d,e,f);return this.layers.addEdge(g),g},removeEdge:function(a,b){this.layers.removeEdge(b)},clear:function(){}},a.GS.extend(a.GS.Context.prototype,e.prototype),setInterval(function(){for(var a=0;a<d.prototype.layers.length;a++)d.prototype.layers[a].drawAll()},25),a.GS.registerContext("canvas",e)}(this),function(a){"use strict";function b(a){this.graph=a,this.lines=[],this.line=""}if(void 0===a.GS)throw new Error("GS is not loaded");a.GS.Graph.prototype.dgs=function(c,d){var e=new b(this);a.jQuery.get(c).then(function(a){e.setData(a),e.parse(),void 0!==d&&d()},function(a){throw new Error(a)})},b.prototype.setData=function(a){var b,c;if(this.lines=a.split("\n").reverse(),c=this.lines.pop(),b=/^DGS00\d$/,!b.test(c))throw new Error('invalid dgs header "'+c+'"');if(c=this.lines.pop(),b=/^\S+ \d+ \d+$/,!b.test(c))throw new Error('invalid dgs header "'+c+'"');for(var d=0;d<this.lines.length;)""===this.lines[d]||"#"===this.lines[d].charAt(0)?this.lines.splice(d,1):d++},b.prototype.ready=function(){return this.lines.length>0},b.prototype.next=function(){return this.line=this.lines.pop(),this},b.prototype.dir=function(){var a=this.line.substr(0,2).toLowerCase();return this.line=this.line.substr(3,this.line.length-3),a},b.prototype.parse=function(){for(var a,b,c,d;this.ready();)switch(this.next(),a=this.dir()){case"an":b=this.nextId(),this.graph.an(b),this.parseAttributes("node",b);break;case"cn":b=this.nextId(),this.parseAttributes("node",this.graph.sn(b));break;case"dn":b=this.nextId(),this.graph.dn(b);break;case"ae":b=this.nextId(),c=this.nextId(),d=this.nextId(),this.graph.ae(b,c,d);break;case"ce":b=this.nextId(),this.parseAttributes("edge",this.graph.se(b));break;case"de":b=this.nextId(),this.graph.de(b),this.parseAttributes("edge",b);break;case"cg":break;case"st":this.graph.st(this.nextReal());break;case"cl":this.graph.cl();break;default:throw new Error('unknown directive "'+a+'"')}},b.prototype.nextId=function(){var a=/^\s*(?:'([^']+)'|"([^"]+)"|([\w\d]+))(?: (.*))?$/,b=a.exec(this.line),c=0;return void 0!==b[++c]||void 0!==b[++c]||void 0!==b[++c]?(this.line=b[4],b[c]):void 0},b.prototype.nextReal=function(){var a=/^(\d+(?:\.\d+)?)$/,b=a.exec(this.line);return b[1]},b.prototype.parseAttributes=function(a){switch(a){case"node":break;case"edge":}}}(window),function(a){"use strict";function b(a){this.graph=a,this.nodes=[],this.links=[];var b;this.graph.addSink(this);for(b in this.graph.nodes)this.registerNode(b);for(b in this.graph.edges)this.registerEdge(b)}function c(a){b.call(this,a),this.layout_running=!1,this.layout=d3.layout.force().gravity(0).charge(-15).linkDistance(30);var c=this;this.layout.on("tick",function(){c.pushXY()})}b.prototype={start:function(){},reload:function(){},stop:function(){},registerNode:function(a){var b=this.graph.nodes[a];b.layoutIndex=this.nodes.length,this.nodes.push({id:a})},unregisterNode:function(a){var b=this.graph.nodes[a];this.nodes.splice(b.layoutIndex,1)},registerEdge:function(a){var b=this.graph.edges[a];b.layoutIndex=this.links.length,this.links.push({id:a,source:this.nodes[b.source.layoutIndex],target:this.nodes[b.target.layoutIndex],value:1})},unregisterEdge:function(a){var b=this.graph.edges[a];this.links.splice(b.layoutIndex,1)},nodeAdded:function(a,b,c){this.registerNode(c),this.reload()},nodeRemoved:function(a,b,c){this.unregisterNode(c),this.reload()},edgeAdded:function(a,b,c){this.registerEdge(c),this.reload()},edgeRemoved:function(a,b,c){this.unregisterEdge(c),this.reload()},graphCleared:function(){this.nodes=[],this.links=[],this.reload()},pushXY:function(){for(var a=0;a<this.nodes.length;a++)this.graph.setXY(this.nodes[a].id,this.nodes[a].x,this.nodes[a].y)},nodeAttributeAdded:function(){},nodeAttributeChanged:function(){},nodeAttributeRemoved:function(){},edgeAttributeAdded:function(){},edgeAttributeChanged:function(){},edgeAttributeRemoved:function(){},graphAttributeAdded:function(){},graphAttributeChanged:function(){},graphAttributeRemoved:function(){},stepBegins:function(){}},a.GS.extend(a.GS.Sink.prototype,b.prototype),c.prototype={start:function(){this.layout_running=!0,this.reload()},reload:function(){this.layout_running&&this.layout.stop(),this.layout.nodes(this.nodes).links(this.links),this.layout_running&&this.layout.start()},stop:function(){this.layout_running=!1,this.layout.stop()}},a.GS.extend(b.prototype,c.prototype),a.GS.Layout=b,a.GS.ForceLayout=c}(this),function(a){"use strict";function b(b,c){a.GS.Node.call(this,b,c)}function c(b){var c;try{c=b.getContext("experimental-webgl"),c.viewportWidth=b.width,c.viewportHeight=b.height}catch(d){a.console.log("can not initialize webgl")}return c}function d(a,b){void 0===a&&(a=g),void 0===b&&(b=h),this.vertexShaderCode=a,this.fragmentShaderCode=b}function e(){}function f(b){if(a.GS.Context.call(this,b),this.canvas=document.createElement("canvas"),this.gl=c(this.canvas),!this.gl)throw new Error("no webgl support");this.vertexBuffer=this.gl.createBuffer(),this.edgesBuffer=this.gl.createBuffer(),this.vertices=[],this.nodeShader=new d,this.edgeShader=new e}if(void 0===a.GS)throw new Error("GS is not loaded");{var g=["attribute vec2 aVertexPos;","attribute vec2 aCustomAttributes;","uniform vec2 uScreenSize;","uniform mat4 uTransform;","varying vec4 color;","void main(void) {","   gl_Position = uTransform * vec4(aVertexPos/uScreenSize, 0, 1);","   gl_PointSize = aCustomAttributes[1] * uTransform[0][0];","   float c = aCustomAttributes[0];","   color = vec4(0.0, 0.0, 0.0, 255.0);","   color.b = mod(c, 256.0); c = floor(c/256.0);","   color.g = mod(c, 256.0); c = floor(c/256.0);","   color.r = mod(c, 256.0); c = floor(c/256.0); color /= 255.0;","}"].join("\n"),h=["precision mediump float;","varying vec4 color;","void main(void) {","   gl_FragColor = color;","}"].join("\n");[].join("\n"),[].join("\n")}b.prototype={updateShapePosition:function(){this.graph.context.vertices[2*this.index+0]=this.pixelX,this.graph.context.vertices[2*this.index+1]=this.pixelY,this.graph.context.updateVertex()}},d.prototype={init:function(){},activate:function(){}},e.prototype={},f.prototype={createNode:function(a,c){var d=new b(a,c);return d},removeNode:function(){},createEdge:function(b,c,d,e,f){return new a.GS.Edge(b,c,d,e,f)},removeEdge:function(){},clear:function(){},zoom:function(){},nodeIndexChanged:function(a,b,c){this.vertices[2*c+0]=this.vertices[2*b+0],this.vertices[2*c+1]=this.vertices[2*b+1]},edgeIndexChanged:function(){},updateVertex:function(){var a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.bufferData(a.ARRAY_BUFFER,new Float32Array(this.vertices),a.STATIC_DRAW),this.vertexBuffer.itemSize=2,this.vertexBuffer.numItems=this.vertices.length/2}},a.GS.extend(a.GS.Context.prototype,f.prototype)}(this);
//# sourceMappingURL=w3sink.min.map